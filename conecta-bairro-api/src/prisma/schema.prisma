generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String
  whatsapp  String
  cep       String
  role      UserRole @default(CLIENT)

  service   Service?
  requests  Request[] @relation("ClientRequests")
  reviews   Review[]
}

model Service {
  id          Int     @id @default(autoincrement())
  title       String
  description String
  priceRange  String

  provider    User     @relation(fields: [providerId], references: [id])
  providerId  Int      @unique
  category    Category @relation(fields: [categoryId], references: [id])
  categoryId  Int

  areas     ServiceArea[]
  requests  Request[]
  reviews   Review[]
}

model ServiceArea {
  id        Int     @id @default(autoincrement())
  service   Service @relation(fields: [serviceId], references: [id])
  serviceId Int
  city      String
  neighbor  String
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  services Service[]
}

model Request {
  id          Int           @id @default(autoincrement())
  description String
  status      RequestStatus @default(PENDING)

  client      User    @relation("ClientRequests", fields: [clientId], references: [id])
  clientId    Int
  service     Service @relation(fields: [serviceId], references: [id])
  serviceId   Int

  review      Review?
}

model Review {
  id        Int     @id @default(autoincrement())
  rating    Int
  comment   String

  client    User    @relation(fields: [clientId], references: [id])
  clientId  Int
  service   Service @relation(fields: [serviceId], references: [id])
  serviceId Int
  request   Request @relation(fields: [requestId], references: [id])
  requestId Int     @unique
}

enum UserRole {
  CLIENT
  PROVIDER
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}
